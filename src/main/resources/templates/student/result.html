<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Exam Submitted</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Import Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
        body {
            background-color: #f8f9fa; /* Light gray background */
        }
        .result-card {
            border: 0;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        .result-icon {
            font-size: 5rem;
            line-height: 1;
        }
        .score-display {
            font-size: 3.5rem;
            font-weight: 700;
        }
        .score-raw {
            font-size: 1.25rem;
            color: #6c757d;
        }
    </style>
</head>
<body>

<div th:replace="~{fragments :: navbar}"></div>


<div class="container mt-5">
  <div class="row">
    <div class="col-md-8 offset-md-2 text-center">

      <!-- Calculate percentage and pass status (using 50% as pass mark) -->
      <th:block th:with="percentage=${(total > 0) ? (score * 100.0) / total : 0}, isPass=${percentage >= 50}">

        <div class="card result-card">
          <div class="card-body p-5">

            <!-- Pass/Fail Icon and Header -->
            <div th:if="${isPass}">
              <i class="bi bi-trophy-fill text-success result-icon"></i>
              <h1 class="mt-3">Congratulations, You Passed!</h1>
            </div>
            <div th:unless="${isPass}">
              <i class="bi bi-exclamation-triangle-fill text-danger result-icon"></i>
              <h1 class="mt-3">Better Luck Next Time</h1>
            </div>

            <p class="fs-5 text-muted">You have successfully submitted the exam.</p>

            <hr class="my-4">

            <!-- Score Display -->
            <h3 class="card-title text-muted">Your Score</h3>
            <div class="score-display" th:classappend="${isPass ? 'text-success' : 'text-danger'}">
              <!--
                --- THIS IS THE FIX (Line 66) ---
                Changed from: th:text="${#numbers.formatDecimal(percentage, 1, 1) + '%'}"
                To:           th:text="|${#numbers.formatDecimal(percentage, 1, 1)}%|"
              -->
              <span th:text="|${#numbers.formatDecimal(percentage, 1, 1)}%|">75.0%</span>
            </div>
            <div class="score-raw" th:text="|${score} out of ${total} points|">15 / 20</div>

            <!-- Progress Bar -->
            <div class="progress mt-4" style="height: 25px;">
              <div class="progress-bar"
                   th:classappend="${isPass ? 'bg-success' : 'bg-danger'}"
                   role="progressbar"
                   th:style="|width: ${percentage}%;|"
                   th:attr="aria-valuenow=${percentage}"
                   aria-valuemin="0" aria-valuemax="100" th:text="|${#numbers.formatDecimal(percentage, 1, 0)}%|">
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="mt-5">
            <a th:href="@{/student/dashboard}" class="btn btn-secondary btn-lg me-2">
              <i class="bi bi-house-door-fill me-2"></i>Back to Dashboard
            </a>
            <!-- This 'resultId' is passed as a flash attribute from ExamController -->
            <a th:if="${resultId != null}" th:href="@{/student/review/{id}(id=${resultId})}" class="btn btn-info btn-lg">
              <i class="bi bi-search me-2"></i>Review Your Answers
            </a>
          </div>

        </div>
    </div>

    </th:block>
  </div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>