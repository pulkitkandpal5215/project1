<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <!-- We can add a <style> tag for the profile picture -->
    <style>
        .navbar-profile-pic {
            width: 30px;
            height: 30px;
            border-radius: 50%; /* Makes it round */
            object-fit: cover;   /* Ensures the image covers the area */
            margin-right: 8px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>

<!-- th:fragment="navbar" defines a reusable fragment -->
<nav th:fragment="navbar" class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/}">Online Exam System</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/}">Home</a>
                </li>

                <!-- Admin Links -->
                <li class="nav-item" sec:authorize="hasRole('ADMIN')">
                    <a class="nav-link" th:href="@{/admin/dashboard}">Manage Exams</a>
                </li>
                <li class="nav-item" sec:authorize="hasRole('ADMIN')">
                    <a class="nav-link" th:href="@{/admin/students}">Manage Students</a>
                </li>

                <!-- Student Links -->
                <li class="nav-item" sec:authorize="hasRole('STUDENT')">
                    <a class="nav-link" th:href="@{/student/dashboard}">Dashboard</a>
                </li>
                <li class="nav-item" sec:authorize="hasRole('STUDENT')">
                    <a class="nav-link" th:href="@{/student/my-results}">My Results</a>
                </li>
            </ul>

            <!-- Login/Register/Logout Links -->
            <ul class="navbar-nav ms-auto">
                <li class="nav-item" sec:authorize="!isAuthenticated()">
                    <a class="nav-link" th:href="@{/login}">Login</a>
                </li>
                <li class="nav-item" sec:authorize="!isAuthenticated()">
                    <a class="nav-link" th:href="@{/register}">Create Account</a>
                </li>

                <!-- If user is authenticated -->
                <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <!-- --- NEW PROFILE PIC DISPLAY --- -->

                        <!-- 1. If user has a profile pic -->
                        <img th:if="${globalProfilePicUrl != null}"
                             th:src="@{${globalProfilePicUrl}}"
                             alt="Profile"
                             class="navbar-profile-pic">

                        <!-- 2. If user does NOT have a pic, show a default icon -->
                        <svg th:if="${globalProfilePicUrl == null}"
                             xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                             class="bi bi-person-circle navbar-profile-pic" viewBox="0 0 16 16"
                             style="background-color: white;">
                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                            <path fill-rule="evenodd"
                                  d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                        </svg>

                        <span sec:authentication="name"></span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                        <li>
                            <a class="dropdown-item" href="javascript:document.getElementById('logoutForm').submit();">Logout</a>
                            <form th:action="@{/logout}" method="post" id="logoutForm" class="d-none"></form>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>